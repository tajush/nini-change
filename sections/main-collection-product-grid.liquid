{{ 'template-collection.css' | asset_url | stylesheet_tag }}
{{ 'component-loading-overlay.css' | asset_url | stylesheet_tag }}
{%- if settings.pagination_type == 'load_more' or settings.pagination_type == 'infinite_scroll' -%}
  <script src="{{ 'load-more.js' | asset_url }}" defer="defer"></script>
{%- endif -%}
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js" defer="defer" ></script>
<link rel="preload" href="{{ 'component-card.css' | asset_url }}" as="style" onload="this.onload=null;this.rel='stylesheet'">
<link rel="preload" href="{{ 'component-price.css' | asset_url }}" as="style" onload="this.onload=null;this.rel='stylesheet'">
<link rel="preload" href="{{ 'component-badge.css' | asset_url }}" as="style" onload="this.onload=null;this.rel='stylesheet'">
<link rel="preload" href="{{ 'component-rte.css' | asset_url }}" as="style" onload="this.onload=null;this.rel='stylesheet'">


<noscript>{{ 'component-card.css' | asset_url | stylesheet_tag }}</noscript>
<noscript>{{ 'component-price.css' | asset_url | stylesheet_tag }}</noscript>
<noscript>{{ 'component-badge.css' | asset_url | stylesheet_tag }}</noscript>
<noscript>{{ 'component-rte.css' | asset_url | stylesheet_tag }}</noscript>

{%- if section.settings.enable_filtering or section.settings.enable_sorting -%}
	{{ 'component-facets.css' | asset_url | stylesheet_tag }}
{%- endif -%}

<script src="{{ 'collection-filters-form.js' | asset_url }}" defer="defer"></script>

<style>
	.custom-dropdown {
    position: relative;
    width: 100%; /* Set width as needed */
}

.selected-option {
    padding: 17px;
    border: 1px solid #ccc;
    cursor: pointer;
	height: 100%;
	width: 100%;
}

.options {
    position: absolute;
    top: 100%;
    left: 0;
    width: 100%;
    list-style: none;
    padding: 0;
    margin: 0;
    display: none;
}

.options li {
    padding: 10px;
    cursor: pointer;
	position: sticky;
    top: 0;
    padding: 2rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: 1.2rem;
    color: rgb(var(--color-foreground-title));
    /* border-bottom: .1rem solid rgb(var(--color-border-input)); */
    background-color: #fff;
    z-index: 100;
	/* border-top: 1px  solid #ccc; */
	border-bottom: 1px  solid #ccc;
	

}

/* .options li.selected {
    background-color: #f0f0f0; Set selected background color
} */

</style>

{%- assign sort_by = collection.sort_by | default: collection.default_sort_by -%}


{%- if collection.all_products_count > 0 -%}
	<div class="container">
		<div class="collection-filters" id="main-collection-filters" data-id="{{ section.id }}">
			{%- if section.settings.enable_filtering or section.settings.enable_sorting -%}
				{%- assign total_active_values = 0 -%}
				{% assign countFilters = collection.filters | size %}
				<collection-filters-form class="facets small-hide">
					<form id="CollectionFiltersForm" class="facets__form">
						{% if section.settings.enable_filtering %}
							{%- for filter in collection.filters -%}
								{% case filter.param_name %}
									{% when 'filter.p.product_type' %}
										{% assign countFilters = countFilters | minus: 1 %}
										<div class="product-type__wrapper">
											<ul class="product-type__list list-unstyled js-filter" role="list" data-index="{{ forloop.index }}">
												<li class="product-type__item product-type__item_reset">
													<facet-remove>
														<a href="{{ filter.url_to_remove }}" class="product-type__all link-hover-line">
															<span>{{ 'sections.collection_template.all' | t }}</span>
														</a>
													</facet-remove>
													<svg width="10" height="10" viewBox="0 0 10 10" fill="none" xmlns="http://www.w3.org/2000/svg">
														<path d="M-2.18557e-07 5L3.50447 3.50447L5 -2.18557e-07L6.49553 3.50447L10 5L6.49553 6.49553L5 10L3.50447 6.49553L-2.18557e-07 5Z" fill="#BEB0AA"/>
													</svg>
												</li>
												{%- for value in filter.values -%}
													<li class="product-type__item {% if value.count == 0 and value.active == false %} product-type__item--disabled{% endif %}" tabindex="0">
														<input type="checkbox"
																	 name="{{ value.param_name }}"
																	 value="{{ value.value }}"
																	 id="Filter-{{ filter.label | escape }}-{{ forloop.index }}"
																	 {% if value.active %}checked{% endif %}
															{% if value.count == 0 and value.active == false %}disabled{% endif %}
														>
														<label for="Filter-{{ filter.label | escape }}-{{ forloop.index }}" class="link-hover-line">
															<span>{{ value.label | escape }}</span>
														</label>
														<svg class="icon icon-filter-star" width="10" height="10" viewBox="0 0 10 10" fill="none" xmlns="http://www.w3.org/2000/svg">
															<path d="M-2.18557e-07 5L3.50447 3.50447L5 -2.18557e-07L6.49553 3.50447L10 5L6.49553 6.49553L5 10L3.50447 6.49553L-2.18557e-07 5Z" fill="#BEB0AA"/>
														</svg>
													</li>
												{%- endfor -%}
											</ul>
										</div>
								{% endcase %}
							{% endfor %}
						{% endif %}

						<div class="columns">
							<div class="facets__container">
								{% if section.settings.enable_filtering %}
									<div class="facets__wrapper {% if countFilters > 3 %} facets__wrapper_size {% endif %}">
										{%- for filter in collection.filters -%}
											{%- assign total_active_values = total_active_values | plus: filter.active_values.size -%}
											{% case filter.type %}
												{% when 'list' %}
													{% if filter.param_name != 'filter.p.product_type' %}
														<details class="disclosure-has-popup facets__disclosure {% if filter.param_name == 'filter.p.vendor' %} facets__disclosure_brand {% endif %} js-filter" data-index="{{ forloop.index }}">
															<summary class="facets__summary">
																<div class="facets__summary-inner">
																	<span>{{ filter.label | escape }}</span>
																	<span class="count-bubble">{%- if filter.active_values.size > 0 -%}{{ filter.active_values.size }}{%- endif -%}</span>
																	{% render 'icon-filter-two' %}
																</div>
															</summary>
															<div class="facets__display">
																<div class="facets__header">
																	<span class="facets__selected no-js-hidden">{{ 'sections.collection_template.filters_selected' | t: count: filter.active_values.size }}</span>
																	<facet-remove>
																		<a href="{{ filter.url_to_remove }}" class="facets__reset link">
																			{{ 'sections.collection_template.reset' | t }}
																		</a>
																	</facet-remove>
																</div>

																<ul class="facets__list list-unstyled" role="list">
																	{%- for value in filter.values -%}
																		<li class="list-menu__item facets__item">
																			<input type="checkbox"
																						 name="{{ value.param_name }}"
																						 value="{{ value.value }}"
																						 id="Filter-{{ filter.label | escape }}-{{ forloop.index }}"
																						 {% if value.active %}checked{% endif %}
																				{% if value.count == 0 and value.active == false %}disabled{% endif %}
																			>
																			<label for="Filter-{{ filter.label | escape }}-{{ forloop.index }}" class="facet-checkbox{% if value.count == 0 and value.active == false %} facet-checkbox--disabled{% endif %}">
																				<svg class="icon icon-checkmark"
																						 width="9"
																						 height="6"
																						 viewBox="0 0 9 6" fill="none" xmlns="http://www.w3.org/2000/svg">
																					<path d="M3.17644 4.58847L7.76441 0L8.47068 0.705765L3.17644 6L0 2.82356L0.705765 2.11779L3.17644 4.58847Z" fill="#56443E"/>
																				</svg>
																				<span class="facet-checkbox__label">{{ value.label | escape }}</span>
																				<span class="facet-checkbox__count">{{ value.count }}</span>
																			</label>
																		</li>
																	{%- endfor -%}
																</ul>
															</div>
														</details>
													{% endif %}
												{% when 'price_range' %}
													{% liquid
														assign currencies_using_comma_decimals = 'ANG,ARS,BRL,BYN,BYR,CLF,CLP,COP,CRC,CZK,DKK,EUR,HRK,HUF,IDR,ISK,MZN,NOK,PLN,RON,RUB,SEK,TRY,UYU,VES,VND' | split: ','
														assign uses_comma_decimals = false
														if currencies_using_comma_decimals contains cart.currency.iso_code
															assign uses_comma_decimals = true
														endif %}
													<details class="disclosure-has-popup facets__disclosure js-filter" data-index="{{ forloop.index }}">
														<summary class="facets__summary">
															<div class="facets__summary-inner">
																<span>{{ filter.label | escape }}</span>
																<span class="count-bubble{%- if filter.min_value.value or filter.max_value.value -%}{{ filter.active_values.size }} count-bubble--dot{% endif %}"></span>
																{% render 'icon-caret' %}
															</div>
														</summary>
														<div class="facets__display">
															<div class="facets__header">
																{%- assign max_price_amount = filter.range_max | money | escape -%}
																<span class="facets__selected">
																{{ "sections.collection_template.max_price" | t: price: max_price_amount }}
															</span>
																<facet-remove>
																	<a href="{{ filter.url_to_remove }}" class="facets__reset link">
																		{{ 'sections.collection_template.reset' | t }}
																	</a>
																</facet-remove>
															</div>
															<price-range class="facets__price">
																{% liquid
																	if uses_comma_decimals
																		assign max_price = filter.range_max | money_without_currency | replace: '.', '' | replace: ',', '.' 
																	else
																		assign max_price = filter.range_max | money_without_currency | replace: ',', '' 
																	endif

																	if uses_comma_decimals 
																		if filter.min_value.value
																			assign current_price_min = filter.min_value.value | money_without_currency | replace: '.', '' | replace: ',', '.' 
																			assign range_min = current_price_min | divided_by: max_price | times: 100
																		else
																			assign range_min = 0
																			assign current_price_min = 0
																		endif
																	else 
																		if filter.min_value.value
																			assign current_price_min = filter.min_value.value | money_without_currency | replace: ',', '' 
																			assign range_min = current_price_min | divided_by: max_price | times: 100
																		else
																			assign range_min = 0
																			assign current_price_min = 0
																		endif
																	endif
																	
																	if uses_comma_decimals 
																		if filter.max_value.value
																			assign current_price_max = filter.max_value.value | money_without_currency | replace: '.', '' | replace: ',', '.'
																			assign range_max = current_price_max | divided_by: max_price | times: 100
																		else
																			assign current_price_max = max_price
																			assign range_max = 100 
																		endif
																	else 
																		if filter.max_value.value
																			assign current_price_max = filter.max_value.value | money_without_currency | replace: ',', '' 
																			assign range_max = current_price_max | divided_by: max_price | times: 100
																		else
																			assign current_price_max = max_price
																			assign range_max = 100
																		endif	
																	endif
																%}
																<div class="facets__price-wrapper">
																	<div class="field">
																		<span class="field__currency">{{ cart.currency.symbol }}</span>
																		<input class="field__input"
																					name="{{ filter.min_value.param_name }}"
																					id="Filter-{{ filter.label | escape }}-GTE"
																			{%- if filter.min_value.value -%}
																				{%- if uses_comma_decimals -%}
																					value="{{ filter.min_value.value | money_without_currency | replace: '.', '' | replace: ',', '.' }}"
																				{%- else -%}
																					value="{{ filter.min_value.value | money_without_currency | replace: ',', '' }}"
																				{% endif %}
																			{%- endif -%}
																					type="number"
																					placeholder="0"
																					min="0"
																					max="{{ filter.range_max | money_without_currency | replace: ',', '' }}"
																			>
																		<label class="field__label" for="Filter-{{ filter.label | escape }}-GTE">{{ 'sections.collection_template.from' | t }}</label>
																	</div>
																	<div class="field">
																		<span class="field__currency">{{ cart.currency.symbol }}</span>
																		<input class="field__input"
																					name="{{ filter.max_value.param_name }}"
																					id="Filter-{{ filter.label | escape }}-LTE"
																			{%- if filter.max_value.value -%}
																				{%- if uses_comma_decimals -%}
																					value="{{ filter.max_value.value | money_without_currency | replace: '.', '' | replace: ',', '.' }}"
																				{%- else -%}
																					value="{{ filter.max_value.value | money_without_currency | replace: ',', '' }}"
																				{% endif %}
																			{%- endif -%}
																					type="number"
																					placeholder="{{ filter.range_max | money_without_currency | replace: ',', '' }}"
																					min="0"
																					max="{{ filter.range_max | money_without_currency | replace: ',', '' }}"
																		>
																		<label class="field__label" for="Filter-{{ filter.label | escape }}-LTE">{{ 'sections.collection_template.to' | t }}</label>
																	</div>
																</div>
																<div class="facets__range" style="--range-min: {{ range_min }}%; --range-max: {{ range_max }}%">
																	<input 
																		type="range" 
																		value="{{ current_price_min }}" 
																		min="0" 
																		max = "{{ max_price }}"
																		class="field__range"
																	/>
																	<input 
																		type="range" 
																		value="{{ current_price_max }}" 
																		min="0" 
																		max = "{{ max_price }}"
																		class="field__range"
																	/>
																</div>
														</price-range>
													</details>
											{% endcase %}
										{%- endfor -%}
										<p class="facets__product-count" role="status">
											<span id="ProductCountDesktop">
												{%- if collection.products_count == collection.all_products_count -%}
													{{ 'sections.collection_template.product_count_simple' | t: count: collection.products_count }}
												{%- else -%}
													{{ 'sections.collection_template.product_count' | t: product_count: collection.products_count, count: collection.all_products_count }}
												{%- endif -%}
											</span>
										</p>
										<noscript>
											<button type="submit" class="facets__button button">{{ 'sections.collection_template.filter_button' | t }}</button>
										</noscript>
									</div>
								{% endif %}
							</div>

							<div class="columns__right {% if countFilters > 3 and section.settings.enable_filtering %} columns__right_column {% endif %} {% if section.settings.enable_filtering == false %} columns__right_no-filter {% endif %}">
								{%- if section.settings.enable_sorting -%}
									<div class="facets-sorting sorting">
										<div class="facets-sorting__field">
											<div class="select">
												
												 {% comment %} <select style="display:none" name="sort_by" class="select__select collection-filters__sort" id="SortBy" aria-describedby="a11y-refresh-page-message">
													<option value="manual">Sort</option>
													<option value="created-descending" {% if sort_by == "created-descending" %} selected="selected"{% endif %}>Newest first</option>
												{%- for option in collection.sort_options -%}
                                                      {% unless option.value contains 'title-ascending' or option.value contains 'title-descending' or option.value contains 'created-ascending' or option.value contains 'created-descending' or option.value contains 'manual' %}
														<option value="{{ option.value | escape }}"{% if option.value == sort_by %} selected="selected"{% endif %}>{{ option.name | escape }}</option>
                                                      {% endunless %}
													{%- endfor -%}
												</select>    {% endcomment %}
												{%- assign sort_by = collection.sort_by | default: "manual" -%}
												<div id="custom-dropdown" class="custom-dropdown">
													<div class="selected-option">Sort</div>
													<ul class="options select__select collection-filters__sort" id="SortBy" aria-describedby="a11y-refresh-page-message">
													  {% assign sort_by = collection.sort_by | default: collection.default_sort_by %}
													  <li selected="selected" value="manual" {% if sort_by == "manual" %}class="selected"{% endif %}>Sort</li>
													  <li selected="selected" value="created-descending" {% if sort_by == "created-descending" %}class="selected"{% endif %}>Newest first</li>
													  {% for option in collection.sort_options %}
														{% unless option.value contains 'title-ascending' or option.value contains 'title-descending' or option.value contains 'created-ascending' or option.value contains 'created-descending' or option.value contains 'manual' %}
														  <li selected="selected" value="{{ option.value }}" {% if option.value == sort_by %}class="selected"{% endif %}>{{ option.name }}</li>
														{% endunless %}
													  {% endfor %}
													</ul>
												  </div>

												

												{% render 'icon-filter-two' %}
											</div>
										</div>
										<noscript>
											<button type="submit" class="button button--small">{{ 'sections.collection_template.sort_button' | t }}</button>
										</noscript>
									</div>
								{%- endif -%}
							</div>
						</div>

						{% if section.settings.enable_filtering %}
							<div class="active-facets active-facets-desktop">
								{%- for filter in collection.filters -%}
									{% if filter.param_name != 'filter.p.product_type' %}
										{%- for value in filter.active_values -%}
											<facet-remove>
												<a href="{{ value.url_to_remove }}" class="active-facets__button">
											<span class="active-facets__button-inner">
												{{ value.label | escape }}
												{% render 'icon-close-small' %}
											</span>
												</a>
											</facet-remove>
										{%- endfor -%}
										{% if filter.type == "price_range" %}
											{%- if filter.min_value.value != nil or filter.max_value.value != nil -%}
												<facet-remove>
													<a href="{{ filter.url_to_remove }}" class="active-facets__button">
												<span class="active-facets__button-inner">
													{%- if filter.min_value.value -%}{{ filter.min_value.value | money }}{%- else -%}{{ 0 | money }}{%- endif -%}-{%- if filter.max_value.value -%}{{ filter.max_value.value | money }}{%- else -%}{{ filter.range_max | money }}{%- endif -%}
													{% render 'icon-close-small' %}
												</span>
													</a>
												</facet-remove>
											{%- endif -%}
										{% endif %}
									{% endif %}
								{%- endfor -%}
								<facet-remove>
									<a href="{{ collection.url }}?sort_by={{ sort_by }}" class="active-facets__button-remove">
										<span>{{ 'sections.collection_template.clear_all' | t }}</span>
									</a>
								</facet-remove>
							</div>
						{% endif %}

						{% if collection.current_vendor or collection.current_type %}
							<input type="hidden" name="q" value="{{ collection.current_vendor }}{{ collection.current_type }}">
						{% endif %}
					</form>
				</collection-filters-form>

				<menu-drawer class="mobile-facets__wrapper" data-breakpoint="mobile">
					<details class="disclosure-has-popup medium-hide large-up-hide">
						<summary>
          <span class="mobile-facets__open button button--secondary">
            {% render 'icon-filter' %}
            <span>
							{%- if section.settings.enable_filtering and section.settings.enable_sorting -%}
								{{ 'sections.collection_template.filter_and_sort' | t }}
							{%- elsif section.settings.enable_filtering -%}
								{{ 'sections.collection_template.filter_button' | t }}
							{%- elsif section.settings.enable_sorting -%}
								{{ 'sections.collection_template.sort_button' | t }}
							{%- endif -%}
						</span>
            <span class="count-bubble">
              {%- if total_active_values > 0 -%}{{ total_active_values }}{%- endif -%}
            </span>
          </span>
							<span tabindex="0" class="mobile-facets__close mobile-facets__close--no-js modal-close-button">
								{%- render 'icon-close' -%}
							</span>
						</summary>
						<collection-filters-form>
							<form id="CollectionFiltersFormMobile" class="mobile-facets">
								<div class="mobile-facets__inner">
									<div class="mobile-facets__header">
										<div class="mobile-facets__header-inner">
											<h2 class="mobile-facets__heading">
												{%- if section.settings.enable_filtering and section.settings.enable_sorting -%}
													{{ 'sections.collection_template.filter_and_sort' | t }}
												{%- elsif section.settings.enable_filtering -%}
													{{ 'sections.collection_template.filter_button' | t }}
												{%- elsif section.settings.enable_sorting -%}
													{{ 'sections.collection_template.sort_button' | t }}
												{%- endif -%}
											</h2>
											<p class="mobile-facets__count">{{ 'sections.collection_template.product_count' | t: product_count: collection.products_count, count: collection.all_products_count }}</p>
										</div>
									</div>
									<div class="mobile-facets__main">
										{% if section.settings.enable_filtering %}
											{%- for filter in collection.filters -%}
												{% case filter.type %}
													{% when 'list' %}
														<details class="mobile-facets__details js-filter" data-index="mobile-{{ forloop.index }}">
															<summary class="mobile-facets__summary">
																<div>
																	<span>{{ filter.label | escape }}</span>
																	<span class="count-bubble">
															{%- if filter.active_values.size > 0 -%}{{ filter.active_values.size }}{%- endif -%}
														</span>
																	<span class="mobile-facets__arrow no-js-hidden">{% render 'icon-caret' %}</span>
																	<noscript>{% render 'icon-caret' %}</noscript>
																</div>
															</summary>
															<div class="mobile-facets__submenu">
																<button class="mobile-facets__close-button link link--text focus-inset" aria-expanded="true" type="button">
																	{% render 'icon-caret' %}
																	{{ filter.label | escape }}
																</button>
																<ul class="mobile-facets__list list-unstyled" role="list">
																	{%- for value in filter.values -%}
																		<li class="mobile-facets__item list-menu__item">
																			<input class="mobile-facets__checkbox" type="checkbox" name="{{ value.param_name }}" value="{{ value.value }}" id="Filter-{{ filter.label | escape }}-mobile-{{ forloop.index }}"
																						 {% if value.active %}checked{% endif %}
																				{% if value.count == 0 and value.active == false %}disabled{% endif %}
																			>
																			<label for="Filter-{{ filter.label | escape }}-mobile-{{ forloop.index }}" class="mobile-facets__label{% if value.count == 0 and value.active == false %} mobile-facets__label--disabled{% endif %}">
																				<span class="mobile-facets__highlight"></span>
																				<svg class="icon icon-checkmark"
																						 width="9"
																						 height="6"
																						 viewBox="0 0 9 6" fill="none" xmlns="http://www.w3.org/2000/svg">
																					<path d="M3.17644 4.58847L7.76441 0L8.47068 0.705765L3.17644 6L0 2.82356L0.705765 2.11779L3.17644 4.58847Z" fill="#56443E"/>
																				</svg>
																				{{ value.label | escape }} ({{ value.count }})
																			</label>
																		</li>
																	{%- endfor -%}
																</ul>

																<div class="no-js-hidden mobile-facets__footer">
																	<facet-remove>
																		<a href="{{ collection.url }}" class="mobile-facets__clear button button--secondary">{{ 'sections.collection_template.clear' | t }}</a>
																	</facet-remove>
																	<button type="button" class="no-js-hidden button button--primary" onclick="this.closest('.mobile-facets__wrapper').querySelector('summary').click()">{{ 'sections.collection_template.apply' | t }}</button>
																	<noscript>
																		<button class="button button--primary">{{ 'sections.collection_template.apply' | t }}</button>
																	</noscript>
																</div>
															</div>
														</details>
													{% when 'price_range' %}
														<details class="mobile-facets__details js-filter" data-index="mobile-{{ forloop.index }}">
															<summary class="mobile-facets__summary">
																<div>
																	<span>{{ filter.label | escape }}</span>
																	<span class="count-bubble{%- if filter.min_value.value or filter.max_value.value -%}{{ filter.active_values.size }} count-bubble--dot{% endif %}"></span>
																	<span class="mobile-facets__arrow no-js-hidden">{% render 'icon-caret' %}</span>
																	<noscript>{% render 'icon-caret' %}</noscript>
																</div>
															</summary>
															<div class="mobile-facets__submenu">
																<button class="mobile-facets__close-button link link--text focus-inset" aria-expanded="true" type="button">
																	{% render 'icon-caret' %}
																	{{ filter.label | escape }}
																</button>

																<p class="mobile-facets__info">
																	{{ "sections.collection_template.max_price" | t: price: max_price_amount }}
																</p>

																<price-range class="facets__price">
																	<div class="facets__price-wrapper">
																		<div class="field">
																			<span class="field__currency">{{ cart.currency.symbol }}</span>
																			<input class="field__input"
																						name="{{ filter.min_value.param_name }}"
																						id="Mobile-Filter-{{ filter.label | escape }}-GTE"
																				{%- if filter.min_value.value -%}
																					{%- if uses_comma_decimals -%}
																						value="{{ filter.min_value.value | money_without_currency | replace: '.', '' | replace: ',', '.' }}"
																					{%- else -%}
																						value="{{ filter.min_value.value | money_without_currency | replace: ',', '' }}"
																					{% endif %}
																				{%- endif -%}
																						type="number"
																						placeholder="0"
																						min="0"
																						max="{{ filter.range_max | divided_by: 100 | ceil }}"
																			>
																			<label class="field__label" for="Mobile-Filter-{{ filter.label | escape }}-GTE">{{ 'sections.collection_template.from' | t }}</label>
																		</div>
																		<div class="field">
																			<span class="field__currency">{{ cart.currency.symbol }}</span>
																			<input class="field__input"
																						name="{{ filter.max_value.param_name }}"
																						id="Mobile-Filter-{{ filter.label | escape }}-LTE"
																				{%- if filter.max_value.value -%}
																					{%- if uses_comma_decimals -%}
																						value="{{ filter.max_value.value | money_without_currency | replace: '.', '' | replace: ',', '.' }}"
																					{%- else -%}
																						value="{{ filter.max_value.value | money_without_currency | replace: ',', '' }}"
																					{% endif %}
																				{%- endif -%}
																						type="number"
																						placeholder="{{ filter.range_max | divided_by: 100 | ceil }}"
																						min="0"
																						max="{{ filter.range_max | divided_by: 100 | ceil }}"
																			>
																			<label class="field__label" for="Mobile-Filter-{{ filter.label | escape }}-LTE">{{ 'sections.collection_template.to' | t }}</label>
																		</div>
																	</div>
																	<div class="facets__range" style="--range-min: {{ range_min }}%; --range-max: {{ range_max }}%">
																		<input 
																			type="range" 
																			value="{{ current_price_min }}" 
																			min="0" 
																			max = "{{ max_price }}"
																			class="field__range"
																		/>
																		<input 
																			type="range" 
																			value="{{ current_price_max }}" 
																			min="0" 
																			max = "{{ max_price }}"
																			class="field__range"
																		/>
																	</div>
																</price-range>
																<div class="no-js-hidden mobile-facets__footer">
																	<facet-remove>
																		<a href="{{ collection.url }}" class="mobile-facets__clear button button--secondary">{{ 'sections.collection_template.clear' | t }}</a>
																	</facet-remove>
																	<button type="button" class="no-js-hidden button button--primary" onclick="this.closest('.mobile-facets__wrapper').querySelector('summary').click()">{{ 'sections.collection_template.apply' | t }}</button>
																	<noscript>
																		<button class="button button--primary">{{ 'sections.collection_template.apply' | t }}</button>
																	</noscript>
																</div>
															</div>
														</details>
												{% endcase %}
											{%- endfor -%}
										{% endif %}

										{%- if section.settings.enable_sorting -%}
											<div class="mobile-facets__details js-filter" data-index="mobile-{{ forloop.index }}">
												<div class="mobile-facets__summary">
													<div class="mobile-facets__sort">
														<label for="SortBy-mobile">{{ 'sections.collection_template.sort_by_label' | t }}</label>
														<div class="select">
															<select name="sort_by" class="select__select" id="SortBy-mobile" aria-describedby="a11y-refresh-page-message">
																{%- for option in collection.sort_options -%}
																	<option value="{{ option.value | escape }}"{% if option.value == sort_by %} selected="selected"{% endif %}>{{ option.name | escape }}</option>
																{%- endfor -%}
															</select>
															{% render 'icon-filter-two' %}
														</div>
													</div>
												</div>
											</div>
										{%- endif -%}

										<div class="mobile-facets__footer">
											<facet-remove>
												<a href="{{ collection.url }}" class="mobile-facets__clear button button--secondary">{{ 'sections.collection_template.clear' | t }}</a>
											</facet-remove>
											<button type="button" class="no-js-hidden button button--primary" onclick="this.closest('.mobile-facets__wrapper').querySelector('summary').click()">{{ 'sections.collection_template.apply' | t }}</button>
											<noscript>
												<button class="button button--primary">{{ 'sections.collection_template.apply' | t }}</button>
											</noscript>
										</div>
									</div>

									{% if collection.current_vendor or collection.current_type %}
										<input type="hidden" name="q" value="{{ collection.current_vendor }}{{ collection.current_type }}">
									{% endif %}
								</div>
							</form>
						</collection-filters-form>
					</details>
				</menu-drawer>

				<div class="active-facets active-facets-mobile">
					{%- for filter in collection.filters -%}
						{%- for value in filter.active_values -%}
							<facet-remove>
								<a href="{{ value.url_to_remove }}" class="active-facets__button">
              <span class="active-facets__button-inner">
                {{ value.label | escape }}
								{% render 'icon-close-small' %}
              </span>
								</a>
							</facet-remove>
						{%- endfor -%}

						{% if filter.type == "price_range" %}
							{%- if filter.min_value.value != nil or filter.max_value.value != nil -%}
								<facet-remove>
									<a href="{{ filter.url_to_remove }}" class="active-facets__button">
                <span class="active-facets__button-inner">
                  {%- if filter.min_value.value -%}{{ filter.min_value.value | money }}{%- else -%}{{ 0 | money }}{%- endif -%}-{%- if filter.max_value.value -%}{{ filter.max_value.value | money }}{%- else -%}{{ filter.range_max | money }}{%- endif -%}
									{% render 'icon-close-small' %}
                </span>
									</a>
								</facet-remove>
							{%- endif -%}
						{% endif %}
					{%- endfor -%}
					<facet-remove>
						<a href="{{ collection.url }}?sort_by={{ sort_by }}" class="active-facets__button-remove">
							<span>
								{{ 'sections.collection_template.clear_all' | t }}
							</span>
						</a>
					</facet-remove>
				</div>
			{%- endif -%}
		</div>
	</div>
{%- endif -%}

<div id="CollectionProductGrid">
	{%- paginate collection.products by section.settings.products_per_page -%}
		{%- if collection.products.size == 0 -%}
			<div class="collection collection-product collection--empty container" id="main-collection-product-grid" data-id="{{ section.id }}">
				<div class="loading-overlay">
					<div class="loading-overlay__spinner">
						<svg aria-hidden="true" focusable="false" role="presentation" class="spinner" viewBox="0 0 66 66" xmlns="http://www.w3.org/2000/svg">
							<circle class="path" fill="none" stroke-width="6" cx="33" cy="33" r="30"></circle>
						</svg>
					</div>
				</div>

				<div class="title-wrapper center title-wrapper-empty">
					<h2 class="title title--primary">
						{{ 'sections.collection_template.empty' | t }}<br>
						{{ 'sections.collection_template.use_fewer_filters_html' | t: link: routes.collections_url, class: "underlined-link link" }}
					</h2>
				</div>
			</div>
		{%- else -%}
			<div class="collection collection-product container">
				<div class="loading-overlay">
					<div class="loading-overlay__spinner">
						<svg aria-hidden="true" focusable="false" role="presentation" class="spinner" viewBox="0 0 66 66" xmlns="http://www.w3.org/2000/svg">
							<circle class="path" fill="none" stroke-width="6" cx="33" cy="33" r="30"></circle>
						</svg>
					</div>
				</div>
				<ul id="main-collection-product-grid" data-id="{{ section.id }}" class="collection-product-list collection-results collection-product-list--{{ section.settings.columns_mobile }}-mobile load-more-grid">
					{%- for product in collection.products -%}
						<li class="collection-product-card {% if settings.quickview_hover %}quickview--hover{% endif %}">
							{% render 'product-card',
								product_card_product: product,
								media_size: section.settings.image_ratio,
								media_fit: section.settings.image_fit,
								show_secondary_image: section.settings.show_secondary_image,
								add_image_padding: section.settings.add_image_padding,
								show_vendor: section.settings.show_vendor,
								show_desc: section.settings.show_desc,
								show_sku: section.settings.show_sku
							%}
						</li>
					{%- endfor -%}
					{%- if section.settings.image_product_grid != blank and collection.products.size > 6 -%}
						<li class="collection-product-image collection-product-image--{{- section.settings.image_product_grid_position -}}">
							<div class="collection-product-image__wrapper js-parallax"
									 data-parallax-property="translateY"
									 data-parallax-property-value="100"
									 data-parallax-steps="0, 100">
								{%- assign image_size = section.settings.image_product_grid.width | append: 'x' -%}
								<img srcset="{{ section.settings.image_product_grid | img_url: image_size }} 1x, {{ section.settings.image_product_grid | img_url: image_size, scale: 2 }} 2x"
										 src="{{ section.settings.image_product_grid | img_url: image_size }}"
										 alt="{{ section.settings.image_product_grid.alt | escape }}"
										 width="{{ section.settings.image_product_grid.width }}"
										 height="{{ section.settings.image_product_grid.height }}"
										 loading="lazy"
										 class="collection-product-image__media"
								>
							</div>
						</li>
					{%- endif -%}
				</ul>

				{%- if paginate.pages > 1 -%}
					{%- if settings.pagination_type == "load_more" -%}
            {% render 'load-more', next_url: paginate.next.url, count_pages: paginate.pages, current_page: paginate.current_page %}
            <div class="js-hidden">
              {% render 'pagination', paginate: paginate, anchor: '', class: '' %}
            </div>
          {%- elsif settings.pagination_type == 'infinite_scroll' -%}
            {% render 'infinite-scroll',
              next_url: paginate.next.url,
              count_pages: paginate.pages,
              current_page: paginate.current_page
            %}
            <div class="js-hidden">
              {% render 'pagination', paginate: paginate, anchor: '', class: '' %}
            </div>
          {% else %}
            {% render 'pagination', paginate: paginate, anchor: '', class: '' %}
          {%- endif -%}
				{%- endif -%}
			</div>
		{%- endif -%}
	{%- endpaginate -%}
</div>

<script>
  Shopify.queryParams = {};

  // Preserve existing query parameters
  if (location.search.length) {
    var params = location.search.substr(1).split('&');

    for (var i = 0; i < params.length; i++) {
      var keyValue = params[i].split('=');

      if (keyValue.length) {
        Shopify.queryParams[decodeURIComponent(keyValue[0])] = decodeURIComponent(keyValue[1]);
      }
    }
  }

	if(Shopify.queryParams.sort_by){
		const list = document.getElementById('SortBy');
		const selected = document.querySelector('.selected-option')
		const selectedItem = Array.from(list.querySelectorAll('li'))?.find(item => {
			return item.getAttribute('value') === Shopify.queryParams.sort_by
		})
		if(selectedItem){
			selected.textContent = selectedItem.textContent;
			selected.setAttribute('aria-selected', 'true');
			selected.setAttribute('value', selectedItem.getAttribute('value'));
		}
	}

  // Update sort_by query parameter on click
  document.querySelectorAll('.options li').forEach(function(option) {
    option.addEventListener('click', function() {
      var value = option.getAttribute('value');
      var dropdown = document.getElementById('custom-dropdown');
      var selectedOption = dropdown.querySelector('.selected-option');
      selectedOption.textContent = option.textContent;

      Shopify.queryParams.sort_by = value;
      location.search = new URLSearchParams(Shopify.queryParams).toString();
    });
  });
</script>

{% schema %}
{
	"name": "t:sections.main-collection-product-grid.name",
	"tag": "section",
	"class": "collection-grid-section",
	"settings": [
		{
			"type": "range",
			"id": "products_per_page",
			"min": 6,
			"max": 22,
			"step": 1,
			"default": 10,
			"label": "t:sections.main-collection-product-grid.settings.products_per_page.label"
		},
		{
			"type": "image_picker",
			"id": "image_product_grid",
			"label": "t:sections.main-collection-product-grid.settings.image_product_grid.label",
			"info": "t:sections.main-collection-product-grid.settings.image_product_grid.info"
		},
		{
			"type": "select",
			"id": "image_product_grid_position",
			"options": [
				{
					"value": "right",
					"label": "t:sections.main-collection-product-grid.settings.image_product_grid_position.options__1.label"
				},
				{
					"value": "left",
					"label": "t:sections.main-collection-product-grid.settings.image_product_grid_position.options__2.label"
				}
			],
			"default": "right",
			"label": "t:sections.main-collection-product-grid.settings.image_product_grid_position.label"
		},
		{
			"type": "header",
			"content": "t:sections.main-collection-product-grid.settings.header__3.content"
		},
		{
			"type": "select",
			"id": "image_ratio",
			"options": [
				{
					"value": "landscape",
					"label": "t:sections.main-collection-product-grid.settings.image_ratio.options__1.label"
				},
				{
					"value": "portrait",
					"label": "t:sections.main-collection-product-grid.settings.image_ratio.options__2.label"
				},
				{
					"value": "square",
					"label": "t:sections.main-collection-product-grid.settings.image_ratio.options__3.label"
				}
			],
			"default": "square",
			"label": "t:sections.main-collection-product-grid.settings.image_ratio.label"
		},
		{
			"type": "select",
			"id": "image_fit",
			"label": "t:sections.featured-products.settings.image_fit.label",
			"options": [
				{
					"value": "contain",
					"label": "t:sections.featured-products.settings.image_fit.options__1.label"
				},
				{
					"value": "cover",
					"label": "t:sections.featured-products.settings.image_fit.options__2.label"
				}
			],
			"default": "contain"
		},
		{
			"type": "checkbox",
			"id": "show_secondary_image",
			"default": false,
			"label": "t:sections.main-collection-product-grid.settings.show_secondary_image.label"
		},
		{
			"type": "checkbox",
			"id": "show_vendor",
			"default": false,
			"label": "t:sections.main-collection-product-grid.settings.show_vendor.label"
		},
		{
			"type": "checkbox",
			"id": "show_sku",
			"default": false,
			"label": "t:sections.main-collection-product-grid.settings.show_sku.label"
		},
		{
			"type": "checkbox",
			"id": "show_desc",
			"default": false,
			"label": "t:sections.main-collection-product-grid.settings.show_desc.label",
			"info": "t:sections.main-collection-product-grid.settings.show_desc.info"
		},
		{
			"type": "header",
			"content": "t:sections.main-collection-product-grid.settings.header__1.content"
		},
		{
			"type": "checkbox",
			"id": "enable_filtering",
			"default": true,
			"label": "t:sections.main-collection-product-grid.settings.enable_filtering.label",
			"info": "t:sections.main-collection-product-grid.settings.enable_filtering.info"
		},
		{
			"type": "checkbox",
			"id": "enable_sorting",
			"default": true,
			"label": "t:sections.main-collection-product-grid.settings.enable_sorting.label"
		},
		{
      "type": "header",
      "content": "t:sections.main-collection-product-grid.settings.header_mobile.content"
    },
    {
      "type": "select",
      "id": "columns_mobile",
      "default": "1",
      "label": "t:sections.main-collection-product-grid.settings.columns_mobile.label",
      "options": [
        {
          "value": "1",
          "label": "t:sections.main-collection-product-grid.settings.columns_mobile.options__1.label"
        },
        {
          "value": "2",
          "label": "t:sections.main-collection-product-grid.settings.columns_mobile.options__2.label"
        }
      ]
    }
	]
}
{% endschema %}